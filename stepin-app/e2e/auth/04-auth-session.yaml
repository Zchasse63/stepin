appId: com.stepin.app
---
# Test: Session persistence across app restarts
# Priority: P0 - Critical
# Estimated time: 0.5 days
#
# This test verifies that:
# 1. User can sign in successfully
# 2. Session persists after app restart (no re-authentication required)
# 3. User remains authenticated and sees main app screen

# Launch the app
- launchApp:
    clearState: true
- waitForAnimationToEnd

# Load the app from Expo Dev Launcher (development build only)
- tapOn: "http://localhost:8081"
- waitForAnimationToEnd

# Dismiss Expo Dev Menu popup if it appears
- tapOn:
    text: "Continue"
    optional: true
- waitForAnimationToEnd

# Close the Expo Dev Menu by tapping on the background (outside the menu)
- tapOn:
    point: "10%,20%"
    optional: true
- waitForAnimationToEnd

# Step 1: Ensure we're signed out and sign in
- runFlow: ../helpers/ensure-signed-out.yaml

# Verify we're on the sign-in screen
- assertVisible: "Welcome Back"

# Fill in credentials for test user 1
- assertVisible: "Email"
- tapOn: "Email"
- inputText: "test1@stepin.test"

- tapOn: "Password"
- inputText: "TestPass123!"

# Submit sign in
- tapOn: "Sign In"

# Wait for authentication
- waitForAnimationToEnd

# Verify successful signin - should see main app screen
- assertVisible: "Today"

# Verify we're authenticated
- assertNotVisible: "Email"

# Step 2: Stop and restart the app (simulates app being closed and reopened)
- stopApp

# Wait a moment before restarting
- waitForAnimationToEnd

# Restart the app WITHOUT clearing state
- launchApp

# Wait for app to load
- waitForAnimationToEnd

# Load the app from Expo Dev Launcher (development build only)
- tapOn: "http://localhost:8081"
- waitForAnimationToEnd

# Dismiss Expo Dev Menu popup if it appears
- tapOn:
    text: "Continue"
    optional: true
- waitForAnimationToEnd

# Close the Expo Dev Menu by tapping on the background (outside the menu)
- tapOn:
    point: "10%,20%"
    optional: true
- waitForAnimationToEnd

# Step 3: Verify session persisted - should go directly to main app
# Should NOT see auth screens
- assertNotVisible: "Welcome Back"
- assertNotVisible: "Create Account"

# Should see main app screen (Today tab)
- assertVisible: "Today"

# Verify user is still authenticated by checking for authenticated content
# The Today screen should show step data or at least the tab navigation
- assertVisible: "History"
- assertVisible: "Profile"

